[**HOME**](Home) > [**SNOWPLOW TECHNICAL DOCUMENTATION**](SnowPlow technical documentation) > [**Collectors**](collectors)

## Introduction

The Clojure-based collector is a SnowPlow event collector for [SnowPlow] [snowplow], written in Clojure. It is typically used in place of SnowPlow's [CloudFront-based collector] [cloudfront-collector] when site visitors need to be uniquely identified across multiple different domains (e.g. on a content or ad network).

It is designed to be easily runnable on [Amazon Elastic Beanstalk] [elastic-beanstalk].

## How it works

There are two key aspects to the Clojure Collector:

1. **User identification** - how users are uniquely identified across domains
2. **Event logging** - how SnowPlow events are logged ready for Enrichment 

### User identification

The Clojure Collector allows the use of a third-party cookie, making user tracking across domains possible. The CloudFront Collector does not support cross domain tracking of users because user ids are set client-side, whereas the Clojure Collector sets them server-side.

In a nutshell: the Clojure Collector receives events from the [SnowPlow JavaScript tracker] [snowplow-js], sets/updates a third-party user tracking cookie, and returns the pixel to the client.

In pseudocode terms:

	if (request contains an "sp" cookie) {
	    Record that cookie as the user identifier
	    Set that cookie with a now+1 year cookie expiry
	    Add the headers and payload to the output array
	} else {
	    Set the "sp" cookie with a now+1 year cookie expiry
	    Add the headers and payload to the output array
	}

The most recent version of the user cookie is sent back on every request, 

Note that this approach to tracking users across domains works on all browsers except mobile Safari.

### Event logging

The Clojure Collector does not contain any logging functionality of its own (unlike Simon Rumble's [SnowCannon] [snowcannon]); instead, you are expected to run the Clojure Collector in a servlet container such as [Tomcat][tomcat], with access logging (including response headers) enabled.

The Clojure Collector contains all of the configuration required to run the Clojure Collector within a Tomcat container running on Elastic Beanstalk. It is configured in such a way that the output log format is the exact same as that generated by CloudFront.

Note that, currently, the Clojure Collector logs the user ID by appending `&uid=` to the logged request. To prevent there being two `&uid=`s in the querystring (one set by the Clojure Collector, one by the JavaScript Tracker), in the setup guide we tell users to disable the `&uid=` attached by standard in the JavaScript Tracker.

## See also

* [GitHub repository] [github-repo]]
* [Setup guide] [setup-guide]

## Copyright and license

The Clojure Collector is copyright 2012 SnowPlow Analytics Ltd.

Licensed under the [Apache License, Version 2.0] [license] (the "License");
you may not use this software except in compliance with the License.

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

[snowplow]: http://snowplowanalytics.com
[cloudfront-collector]: https://github.com/snowplow/snowplow/tree/master/2-collectors/cloudfront-collector
[snowcannon]: https://github.com/shermozle/SnowCannon
[snowplow-js]: https://github.com/snowplow/snowplow/tree/master/1-trackers/javascript
[setup-guide]: https://github.com/snowplow/snowplow/wiki/Setting%20up%20the%20Clojure%20collector#wiki-war-file

[elastic-beanstalk]: http://aws.amazon.com/elasticbeanstalk/

[github-repo]: https://github.com/snowplow/snowplow/tree/master/2-collectors/clojure-collector
[setup-guide]: https://github.com/snowplow/snowplow/wiki/Setting-up-the-Clojure-collector

[ring]: https://github.com/ring-clojure/ring
[compojure]: https://github.com/weavejester/compojure

[license]: http://www.apache.org/licenses/LICENSE-2.0