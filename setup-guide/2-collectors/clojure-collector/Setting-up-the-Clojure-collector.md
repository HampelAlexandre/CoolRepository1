[**HOME**](Home) > [**SNOWPLOW SETUP GUIDE**](SnowPlow setup guide) > [**Collectors**](choosing-a-collector) > [**Clojure collector setup**](setting-up-the-clojure-collector)

## Overview of the Clojure Collector

The Clojure collector has been designed to enable cross-domain SnowPlow deployments. As such, the Clojure collector performs one key function not performed by the [Cloudfront collector](setting up the cloudfront collector): it sets the user ID (used to identify unique visitors) server side, so that it is possible to reliably identify the same user across domains. This differs from the [Cloudfront collector](setting up the cloudfront collector), where user IDs are set on the client side.

The Clojure collector has been designed to run on [Amazon's Elastic Beanstalk][eb]. This provides two key advantages:

1. It makes it easy to deploy the Clojure collector in a scalable way
2. It makes use of Elastic Beanstalk's built in support for saving Tomcat logs into S3. These are the logs that are processed by the at the [ETL](choosing an etl module) stage to generate SnowPlow event data.

## Contents

Setting up the Clojure collector is a X step process:

1. [Download the Clojoure collector WAR file, or compile it from source](#war-file). (Required)
2. [Create a new application in Elastic Beanstalk, and upload the WAR file into it] (#create-eb-app). (Required)
3. [Configure the application environment, including switching on logging to S3] (#env-config). (Required)
4. Enable support for HTTPS. (Optional, but recommended.)
5. Set your tracker to point at the Clojure collector end point. (Required)
6. Update the EmrEtlRunner configuration YAML file

<a name="war-file"></a>

## 1. Download the Clojoure collector `WAR` file, or compile it from source

You can download the WAR file directly from Github [here][github-download] or from S3 [here][s3-download].

Alternatively, you can build it from the source files. To do so, you will need [Leiningen][leiningen] installed. 

To do so, download the SnowPlow repo:

	$ git clone https://github.com/snowplow/snowplow.git

Navigate into the clojure collector folder:

	$ cd 2-collectors/clojure-collector

Download the required dependencies:

	$ lein deps

And then build the `war` file:

	$ lein ring uberwar

The `war` file will be saved in the `target` subdirectory.

We now need to add a couple of files to the `war`, that were not included as part of the `lein ring uberwar` command above. These files customize the format of the log files generated so that they include all the relevant data points (in particular, the `user_id`), and ensure that the log files have the same format as those generated by the [Cloudfront collector](setting up the cloudfront collector). To add both files, first navigate into the `war-resources` directory:

	$ cd war-resources

Then execute the following two commands:

	$ jar uf ../target/clojure-collector-0.1.0-standalone.war .ebextensions/server.xml 
	$ jar uf ../target/clojure-collector-0.1.0-standalone.war .ebextensions/server-update.config

The `war` file is now ready to be deployed to Amazon Elastic Beanstalk.

<a name="create-eb-app"></a>

## 2. Create a new application in Elastic Beanstalk, and upload the WAR file to it

Amazon makes it easy to create a new application in Elastic Beanstalk and upload your `war` file into it. All of this is possible via the web UI.

On your web browser, log into the [AWS control panel][aws]. From the **Services** dropdown menu select **Elastic Beanstalk**. When the Elastic Beanstalk control panel has loaded, click on the **Create application** button (located on the top right of the screen):

[[/setup-guide/images/clojure-collector-setup-guide/1.png]]

Give your application a suitable name and description. Select **32bit Amazon Linux running Tomcat 7** for the container type. For the **Application Source**, select **Upload your Existing Application**. Use the **Choose File** button to point Elastic Beanstalk at the `war` file from [part 1](#war-file).

[[/setup-guide/images/clojure-collector-setup-guide/2.png]]

Next you need to configure the environment details. You can setup multiple environments for each application, but for our purposes one is enough.

Keep the **Launch a new environment running this application** checkbox checked (i.e. selected), but **deselect** the 2nd option: **Create an RDS DB Instance with this environment**. We do **not** need a database to run the collector.

Give your environment a suitable name, URL and description:

[[/setup-guide/images/clojure-collector-setup-guide/3.png]]

Next we need to specify another set of configuration details. Set a suitable instance type (we recommend at least `m1.small`). If you have an EC2 key pair configured, you can enter the key pair name at this stage: this will enable you to use the key pair to SSH in should you wish. (This is not required, and can be added later without any difficulty.)

For the **Application Health Check URL** enter `/healthcheck`:

[[/setup-guide/images/clojure-collector-setup-guide/4.png]]

Click **Continue**. Amazon gives you the chance to review your inputs. When you've checked them click **Finish**. 

Amazon then sets up your the application and environment. When this is complete, you should see a screen like the one below. Note the green box, and the **Successflly running version First Release** notice.

[[/setup-guide/images/clojure-collector-setup-guide/5.png]]

To test that all is working as expected, select the **Environment Details** dropdown:

[[/setup-guide/images/clojure-collector-setup-guide/7.png]]

Click on the **URL** link. (This is [[http://cc-endpoint.elasticbeanstalk.com]] in the example above.) This should return a 404. If you add `/i' to the path (e.g. `http://cc-endpoint.elasticbeanstalk.com/i`), right click on the window and select **Inspect Element** in Chrome or **Inspect with Firebug** in Firefox, you should be able to see if the cookie has been set:

[[/setup-guide/images/clojure-collector-setup-guide/8.png]]

<a name="env-config"></a>

## 3. Configure your application environment

Now that your application is up and running, there are a number of additional changes updates you will need to make to the configuration. Click on the **Actions button** and select **Edit/Load configuration**.

[[/setup-guide/images/clojure-collector-setup-guide/6.png]]



<a name="https"></a>

## 4. Enable support for HTTPS

Text here

<a name="tracker" ></a>

## 5. Set your Tracker to point at the Clojure collector end point


## 6. Update the EmrEtlRunner configuration YAML file



	:etl:
	  :collector_format: clj-tomcat


[eb]: http://aws.amazon.com/elasticbeanstalk/
[github-download]: https://github.com/snowplow/snowplow/downloads
[s3-download]: https://github.com/snowplow/snowplow/downloads
[leiningen]: https://github.com/technomancy/leiningen
[aws]: https://console.aws.amazon.com/
